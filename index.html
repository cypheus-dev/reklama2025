<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Online - Reklama 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .login-screen {
            text-align: center;
            padding: 40px 0;
        }

        .login-screen h2 {
            color: #667eea;
            margin-bottom: 30px;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .error-message {
            color: #dc3545;
            margin-top: 10px;
            font-size: 0.9em;
            display: none;
        }

        .admin-panel {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .admin-panel h3 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .stat-box .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-box .label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .test-history {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .test-history h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .test-entry {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .test-entry:last-child {
            border-bottom: none;
        }

        .test-entry .date {
            color: #666;
            font-size: 0.9em;
        }

        .test-entry .score {
            font-weight: bold;
            color: #667eea;
        }

        .admin-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-danger {
            background: #dc3545;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
        }

        .btn-success {
            background: #28a745;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }

        .start-screen {
            text-align: center;
            padding: 40px 0;
        }

        .start-screen h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .category-select {
            margin: 30px 0;
        }

        .category-select h3 {
            margin-bottom: 15px;
            color: #555;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .category-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .category-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .category-item input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .category-item label {
            cursor: pointer;
            flex: 1;
            font-weight: 500;
        }

        .difficulty-select {
            margin: 30px 0;
            text-align: center;
        }

        .difficulty-select h3 {
            margin-bottom: 15px;
            color: #555;
        }

        .difficulty-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .difficulty-option {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .difficulty-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .difficulty-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
            margin-left: 10px;
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 20px rgba(108, 117, 125, 0.4);
        }

        .question-container {
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .question-number {
            font-size: 1.2em;
            color: #667eea;
            font-weight: 600;
        }

        .question-type {
            background: #e3f2fd;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #1976d2;
            font-weight: 500;
        }

        .question-category {
            background: #f0f0f0;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #666;
        }

        .question-text {
            font-size: 1.3em;
            margin-bottom: 30px;
            color: #2c3e50;
            line-height: 1.5;
        }

        .answers {
            margin-bottom: 30px;
        }

        .answer {
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .answer::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .answer:hover::before {
            left: 100%;
        }

        .answer:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .answer.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .answer.correct {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.1);
            animation: pulse 0.5s ease;
        }

        .answer.incorrect {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
            animation: shake 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .answer input[type="radio"],
        .answer input[type="checkbox"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .answer label {
            cursor: pointer;
            display: block;
            font-size: 1.1em;
        }

        .true-false-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .true-false-btn {
            padding: 20px 40px;
            font-size: 1.2em;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .true-false-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .true-false-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .true-false-btn.correct {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .true-false-btn.incorrect {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .fill-blank-container {
            margin-bottom: 30px;
        }

        .fill-blank-text {
            font-size: 1.2em;
            line-height: 2;
            color: #2c3e50;
        }

        .fill-blank-input {
            display: inline-block;
            min-width: 150px;
            padding: 5px 10px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 1em;
            background: #f8f9fa;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .fill-blank-input:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .fill-blank-input.correct {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.1);
        }

        .fill-blank-input.incorrect {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }

        .explanation {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            animation: fadeIn 0.3s ease;
        }

        .explanation h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .hint-btn {
            background: #ffc107;
            color: #333;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .hint-btn:hover {
            background: #ffb300;
            transform: translateY(-2px);
        }

        .hint {
            background: #fff8e1;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
            animation: fadeIn 0.3s ease;
        }

        .results {
            text-align: center;
            padding: 40px 0;
            animation: fadeIn 0.5s ease;
        }

        .results h2 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            position: relative;
            transform: rotate(-90deg);
        }

        .score-circle svg {
            width: 100%;
            height: 100%;
        }

        .score-circle .background {
            fill: none;
            stroke: #e0e0e0;
            stroke-width: 10;
        }

        .score-circle .progress {
            fill: none;
            stroke: url(#gradient);
            stroke-width: 10;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease;
        }

        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(90deg);
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
        }

        .grade-badge {
            font-size: 1.5em;
            padding: 15px 30px;
            border-radius: 50px;
            margin: 20px 0;
            display: inline-block;
            font-weight: bold;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .grade-excellent {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
        }

        .grade-good {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
        }

        .grade-pass {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
        }

        .grade-fail {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .category-results {
            margin: 30px 0;
            text-align: left;
        }

        .category-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .category-result .name {
            font-weight: 600;
        }

        .category-result .score {
            color: #667eea;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-card .label {
            color: #666;
            margin-top: 5px;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            z-index: 1000;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translate(-50%, -40%); opacity: 0; }
            to { transform: translate(-50%, -50%); opacity: 1; }
        }

        .modal h3 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .timer {
            font-size: 1.1em;
            color: #666;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .timer-icon {
            width: 20px;
            height: 20px;
            animation: tick 1s infinite;
        }

        @keyframes tick {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(10deg); }
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .category-grid {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 12px 30px;
                font-size: 1em;
            }
            
            .question-text {
                font-size: 1.1em;
            }
            
            .true-false-container {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="progress-bar" id="progressBar"></div>
    
    <div class="container">
        <div class="header">
            <h1>Test z Reklamy</h1>
            <p>dr Błażej Choroś - Lato 2025</p>
        </div>
        
        <div class="content" id="content">
            <!-- Zawartość dynamiczna -->
        </div>
    </div>

    <div class="modal" id="endModal">
        <div class="modal-content">
            <h3>Czy na pewno chcesz zakończyć test?</h3>
            <p>Twoje odpowiedzi zostaną zapisane.</p>
            <br>
            <button class="btn" onclick="finishTest()">Zakończ test</button>
            <button class="btn btn-secondary" onclick="closeModal()">Kontynuuj</button>
        </div>
    </div>

    <script>
        // Rozbudowana baza pytań z wariantami i różnymi typami
        const questionBank = [
            // Pytania z wariantami - system losowo wybierze jeden wariant
            {
                category: "Komunikowanie i proces komunikacji",
                type: "single",
                variants: [
                    {
                        question: "Kto jest autorem modelu komunikacji opisanego pytaniem: 'Kto mówi, co, do kogo, jakim kanałem i z jakim skutkiem?'",
                        answers: ["Harold Lasswell", "Philip Kotler", "Marshall McLuhan", "Claude Shannon"],
                        correct: 0,
                        explanation: "Harold Lasswell w 1927 roku sformułował fundamentalny model komunikacji składający się z pięciu elementów."
                    },
                    {
                        question: "W którym roku Harold Lasswell sformułował swój słynny model komunikacji?",
                        answers: ["1925", "1927", "1930", "1935"],
                        correct: 1,
                        explanation: "Model Lasswella został sformułowany w 1927 roku i do dziś stanowi podstawę analizy procesów komunikacyjnych."
                    },
                    {
                        question: "Ile elementów wyróżnia model komunikacji Lasswella?",
                        answers: ["3 elementy", "4 elementy", "5 elementów", "6 elementów"],
                        correct: 2,
                        explanation: "Model Lasswella wyróżnia 5 elementów: nadawca (kto), komunikat (co), odbiorca (do kogo), kanał (jakim kanałem) i efekt (z jakim skutkiem)."
                    }
                ]
            },
            
            // Pytania wielokrotnego wyboru
            {
                category: "Komunikowanie i proces komunikacji",
                type: "multiple",
                question: "Które z poniższych należą do etapów procesu komunikowania? (zaznacz wszystkie poprawne)",
                answers: [
                    "Kodowanie komunikatu",
                    "Sprzedaż produktu",
                    "Dekodowanie komunikatu",
                    "Interpretacja komunikatu",
                    "Negocjacja ceny"
                ],
                correct: [0, 2, 3],
                explanation: "Do etapów procesu komunikowania należą: sformułowanie intencji, utworzenie komunikatu, kodowanie, transmisja, odbiór, dekodowanie i interpretacja. Sprzedaż i negocjacja to działania marketingowe, nie komunikacyjne.",
                hint: "Pomyśl o tym, co dzieje się z informacją od momentu jej stworzenia do zrozumienia przez odbiorcę."
            },
            
            // Pytania prawda/fałsz
            {
                category: "Komunikowanie i proces komunikacji",
                type: "true-false",
                question: "Nadmiarowość kodu (redundancja) zmniejsza odporność komunikatu na zakłócenia.",
                correct: false,
                explanation: "To fałsz. Nadmiarowość kodu ZWIĘKSZA odporność komunikatu na zakłócenia poprzez dodanie dodatkowych informacji, które pomagają w rekonstrukcji przekazu mimo błędów.",
                hint: "Pomyśl, co się dzieje gdy dodajemy więcej informacji do komunikatu."
            },
            
            // Pytania z lukami do uzupełnienia
            {
                category: "Marketing i reklama",
                type: "fill-blank",
                question: "Marketing mix składa się z czterech elementów nazywanych 4P: Product (_____), Place (_____), Price (_____) i Promotion (_______).",
                blanks: ["produkt", "miejsce", "cena", "promocja"],
                explanation: "Marketing mix 4P to fundamentalna koncepcja marketingu: Product (produkt), Place (miejsce/dystrybucja), Price (cena), Promotion (promocja).",
                hint: "Pomyśl o polskich odpowiednikach angielskich terminów."
            },
            
            // Więcej pytań standardowych z wariantami
            {
                category: "Definicje i funkcje reklamy",
                type: "single",
                variants: [
                    {
                        question: "Która funkcja reklamy odpowiada za przekazywanie informacji o nowych produktach?",
                        answers: ["Funkcja perswazyjna", "Funkcja informacyjna", "Funkcja przypominająca", "Funkcja konkurencyjna"],
                        correct: 1,
                        explanation: "Funkcja informacyjna reklamy polega na przekazywaniu nabywcom informacji o nowych produktach, ich cechach, cenach i miejscach sprzedaży."
                    },
                    {
                        question: "Jak nazywa się funkcja reklamy mająca na celu utrzymanie świadomości marki?",
                        answers: ["Funkcja edukacyjna", "Funkcja nakłaniająca", "Funkcja przypominająca", "Funkcja informacyjna"],
                        correct: 2,
                        explanation: "Funkcja przypominająca służy utrzymaniu świadomości marki i kształtowaniu lojalności konsumentów."
                    }
                ]
            },
            
            // Pytania wielokrotnego wyboru - budowa przekazu
            {
                category: "Budowa przekazu reklamowego",
                type: "multiple",
                question: "Które elementy powinien zawierać USP (Unique Selling Proposal)? (zaznacz wszystkie)",
                answers: [
                    "Jasno określone korzyści",
                    "Cenę produktu",
                    "Wyróżnienie na tle konkurencji",
                    "Wezwanie do działania",
                    "Dane kontaktowe firmy"
                ],
                correct: [0, 2, 3],
                explanation: "USP powinien zawierać: jasno określone korzyści dla klienta, wyróżnienie produktu na tle konkurencji oraz wezwanie do działania. Cena i dane kontaktowe to elementy dodatkowe, nie część USP.",
                hint: "USP to unikatowa propozycja sprzedażowa - co czyni produkt wyjątkowym?"
            },
            
            // Pytanie prawda/fałsz - psychologia
            {
                category: "Psychologia reklamy",
                type: "true-false",
                question: "Wykształceni konsumenci są całkowicie odporni na działanie reklamy dzięki swojej wiedzy.",
                correct: false,
                explanation: "To mit. Badania pokazują, że wykształceni konsumenci często przeceniają swoją odporność. Choć początkowo są bardziej krytyczni, z czasem ich czujność słabnie, a przekonanie o odporności pozostaje.",
                hint: "Czy wiedza o mechanizmach zawsze chroni przed ich działaniem?"
            },
            
            // Pytanie z lukami - segmentacja
            {
                category: "Segmentacja",
                type: "fill-blank",
                question: "Segmentacja grupy docelowej może opierać się na czterech głównych kryteriach: cechy _____, potrzeby, _____ i styl życia oraz stosunek do _____.",
                blanks: ["społeczno-demograficzne", "wartości", "problemu"],
                explanation: "Cztery główne kryteria segmentacji to: cechy społeczno-demograficzne (wiek, płeć, dochód), potrzeby konsumentów, wartości i styl życia oraz stosunek do problemu (szczególnie w reklamie społecznej)."
            },
            
            // Pytania o język reklamy z wariantami
            {
                category: "Język reklamy",
                type: "single",
                variants: [
                    {
                        question: "Jak nazywa się zabieg stylistyczny polegający na nadawaniu przedmiotom martwym cech ludzkich?",
                        answers: ["Metafora", "Personifikacja", "Hiperbola", "Metonimia"],
                        correct: 1,
                        explanation: "Personifikacja (uosobienie) to nadawanie przedmiotom martwym, zwierzętom lub pojęciom abstrakcyjnym cech właściwych ludziom."
                    },
                    {
                        question: "Który przykład najlepiej ilustruje personifikację w reklamie?",
                        answers: [
                            "'Najszybszy samochód w mieście'",
                            "'Twój komputer będzie Ci wdzięczny'",
                            "'Milion satysfakcji'",
                            "'Część zamiast całości'"
                        ],
                        correct: 1,
                        explanation: "Stwierdzenie 'Twój komputer będzie Ci wdzięczny' nadaje komputerowi ludzką cechę wdzięczności, co jest klasycznym przykładem personifikacji."
                    }
                ]
            },
            
            // Marketing społeczny - multiple choice
            {
                category: "Marketing społeczny",
                type: "multiple",
                question: "Które z poniższych są charakterystyczne dla reklamy społecznej w porównaniu z komercyjną?",
                answers: [
                    "Często ma charakter awersyjny",
                    "Korzyści są często odległe w czasie",
                    "Zawsze jest tańsza w produkcji",
                    "Odnosi się do głęboko zakorzenionych postaw",
                    "Wykorzystuje tylko argumentację racjonalną"
                ],
                correct: [0, 1, 3],
                explanation: "Reklama społeczna często ma charakter awersyjny (smutny, przerażający), korzyści bywają odległe w czasie, a postawy do których się odnosi są głęboko zakorzenione w tradycji i wartościach.",
                hint: "Pomyśl o kampaniach społecznych które widziałeś - czym się różniły od reklam produktów?"
            },
            
            // Product placement - true/false
            {
                category: "Product placement",
                type: "true-false",
                question: "Product placement jest dozwolony we wszystkich typach audycji telewizyjnych.",
                correct: false,
                explanation: "Fałsz. Istnieją ścisłe ograniczenia - zakaz dotyczy m.in. serwisów informacyjnych, audycji dla dzieci, religijnych, publicystycznych o tematyce społeczno-politycznej.",
                hint: "Czy w wiadomościach widzisz oznaczenia o lokowaniu produktu?"
            },
            
            // Propaganda - fill blank
            {
                category: "Propaganda",
                type: "fill-blank",
                question: "Technika propagandowa '_____ pęd' polega na sugerowaniu, że wszyscy tak robią, więc ty też powinieneś. Natomiast '_____ kłamstwo' to powtarzanie nieprawdy aż stanie się 'prawdą'.",
                blanks: ["owczy", "wielkie"],
                explanation: "Owczy pęd wykorzystuje presję grupy, a wielkie kłamstwo (big lie) opiera się na mechanizmie familiarności - wielokrotne powtórzenie sprawia, że ludzie zaczynają wierzyć."
            },
            
            // Więcej pytań z różnymi typami...
            
            {
                category: "Rodzaje komunikowania",
                type: "multiple",
                question: "Które sposoby oddziaływania komunikowania są wykorzystywane w reklamie?",
                answers: [
                    "Informowanie",
                    "Perswadowanie",
                    "Wpływanie na emocje",
                    "Dostarczanie doznań estetycznych",
                    "Kontrola umysłu"
                ],
                correct: [0, 1, 2, 3],
                explanation: "Reklama wykorzystuje wszystkie podstawowe sposoby oddziaływania: informowanie (o produkcie), perswadowanie (do zakupu), wpływanie na emocje oraz dostarczanie doznań estetycznych. Kontrola umysłu to mit.",
                hint: "Pomyśl o różnych reklamach - jakie techniki stosują?"
            },
            
            {
                category: "Marketing i reklama",
                type: "true-false",
                question: "Cena skimmingowa polega na wprowadzeniu produktu z niską ceną, aby szybko zdobyć rynek.",
                correct: false,
                explanation: "Fałsz. Cena skimmingowa to strategia WYSOKIEJ ceny początkowej, która jest stopniowo obniżana. Niska cena początkowa to strategia PENETRACYJNA.",
                hint: "Skimming oznacza 'zbieranie śmietanki' - co to sugeruje o cenie?"
            },
            
            {
                category: "Budowa przekazu reklamowego",
                type: "single",
                variants: [
                    {
                        question: "Gdzie najczęściej umieszczamy najsilniejsze argumenty stosując 'efekt ostatniego słowa'?",
                        answers: ["Na początku", "W środku", "Na końcu", "Równomiernie"],
                        correct: 2,
                        explanation: "Efekt ostatniego słowa polega na umieszczeniu najsilniejszych argumentów na końcu przekazu. Jest skuteczny przy odbiorach sceptycznych."
                    },
                    {
                        question: "Dla jakiego typu odbiorców najlepiej sprawdza się 'efekt ostatniego słowa'?",
                        answers: ["Entuzjastycznych", "Sceptycznych", "Obojętnych", "Wszystkich równo"],
                        correct: 1,
                        explanation: "Efekt ostatniego słowa najlepiej sprawdza się przy odbiorcach sceptycznych i przy argumentacji dwustronnej (pokazującej też słabości)."
                    }
                ]
            },
            
            {
                category: "Język reklamy",
                type: "multiple",
                question: "Które środki językowe są często stosowane w sloganach reklamowych?",
                answers: [
                    "Aliteracja",
                    "Rym",
                    "Bardzo długie zdania",
                    "Metafora",
                    "Powtórzenie"
                ],
                correct: [0, 1, 3, 4],
                explanation: "W sloganach stosuje się: aliterację (Fanta - fantastyczny), rym (Ace - wybielacz nad wybielacze), metaforę (kolory słońca) i powtórzenie (radość która trwa i trwa). Długie zdania są niewskazane.",
                hint: "Slogan ma być krótki i chwytliwy - co temu służy?"
            },
            
            {
                category: "Psychologia reklamy",
                type: "fill-blank",
                question: "Reguła prawej ręki polega na umieszczeniu promowanego produktu obok _____ branży. Produkty umieszczone po _____ stronie są lepiej postrzegane przez większość konsumentów.",
                blanks: ["lidera", "prawej"],
                explanation: "Reguła prawej ręki wykorzystuje fakt, że ręka (zazwyczaj prawa) sięgająca po lidera branży 'mija' promowany produkt, zwiększając szansę jego zauważenia. Prawa strona jest preferowana przez mózg."
            },
            
            {
                category: "Marketing społeczny",
                type: "true-false",
                question: "CSR (Corporate Social Responsibility) i marketing społeczny to dokładnie to samo.",
                correct: false,
                explanation: "Fałsz. CSR to społeczna odpowiedzialność biznesu - element strategii firmy. Marketing społeczny to wykorzystanie technik marketingu dla celów społecznych. CSR może być elementem marketingu społecznego, ale nie są tożsame.",
                hint: "CSR to działania firm, marketing społeczny to szerszy proces zmian społecznych."
            },
            
            {
                category: "Segmentacja",
                type: "single",
                variants: [
                    {
                        question: "Dlaczego mówimy, że 'mówiąc do wszystkich, mówisz do nikogo'?",
                        answers: [
                            "Bo to za drogie",
                            "Bo ludzie mają różne potrzeby i wrażliwość na argumenty",
                            "Bo jest to prawnie zabronione",
                            "Bo media mają ograniczony zasięg"
                        ],
                        correct: 1,
                        explanation: "Uniwersalny przekaz jest nieskuteczny, ponieważ różni ludzie preferują różny język, humor, metafory i są wrażliwi na różne argumenty."
                    },
                    {
                        question: "Które kryterium segmentacji jest najbardziej zaawansowane?",
                        answers: [
                            "Wiek i płeć",
                            "Miejsce zamieszkania",
                            "Wartości i styl życia",
                            "Dochody"
                        ],
                        correct: 2,
                        explanation: "Segmentacja według wartości i stylu życia jest bardziej zaawansowana niż demografia, bo uwzględnia sposób spędzania czasu, zainteresowania i hierarchię wartości."
                    }
                ]
            },
            
            {
                category: "Propaganda",
                type: "multiple",
                question: "Które z poniższych są technikami manipulacyjnymi stosowanymi w propagandzie?",
                answers: [
                    "Przenoszenie autorytetu",
                    "Owczy pęd",
                    "Uczciwa argumentacja",
                    "Wielkie kłamstwo",
                    "Strach"
                ],
                correct: [0, 1, 3, 4],
                explanation: "Propaganda stosuje: przenoszenie (wykorzystanie autorytetu), owczy pęd (presja grupy), wielkie kłamstwo (powtarzanie nieprawdy) i strach (kreowanie zagrożenia). Uczciwa argumentacja nie jest techniką manipulacyjną.",
                hint: "Manipulacja to nieuczciwość - które techniki są nieuczciwe?"
            }
        ];

        // Stan aplikacji
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let selectedCategories = [];
        let selectedDifficulty = 'medium';
        let testStartTime;
        let timerInterval;
        let hintsUsed = 0;

        // Inicjalizacja
        document.addEventListener('DOMContentLoaded', function() {
            // Sprawdź czy użytkownik jest zalogowany
            if (sessionStorage.getItem('testAuthenticated') === 'true') {
                showStartScreen();
            } else {
                showLoginScreen();
            }
        });

        // Hasła (zakodowane w base64 dla podstawowej ochrony)
        // Hasło studenta: reklama2025 -> cmVrbGFtYTIwMjU=
        // Hasło admina: admin2025choros -> YWRtaW4yMDI1Y2hvcm9z
        const STUDENT_PASSWORD_HASH = 'cmVrbGFtYTIwMjU=';
        const ADMIN_PASSWORD_HASH = 'YWRtaW4yMDI1Y2hvcm9z';

        // Ekran logowania
        function showLoginScreen() {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="login-screen">
                    <h2>Logowanie do testu</h2>
                    <p>Aby rozpocząć test, wprowadź hasło dostępu.</p>
                    
                    <div class="login-form">
                        <div class="form-group">
                            <label for="password">Hasło:</label>
                            <input type="password" id="password" placeholder="Wprowadź hasło" 
                                   onkeypress="if(event.key==='Enter') login()">
                            <div class="error-message" id="errorMessage">
                                Nieprawidłowe hasło. Spróbuj ponownie.
                            </div>
                        </div>
                        
                        <button class="btn" onclick="login()">Zaloguj się</button>
                    </div>
                    
                    <div style="margin-top: 40px; font-size: 0.9em; color: #666;">
                        <p>Jeśli jesteś studentem grupy dr. Chorosia, hasło otrzymałeś na zajęciach.</p>
                        <p>W razie problemów skontaktuj się: bchoros@uni.opole.pl</p>
                    </div>
                </div>
            `;
            
            // Focus na pole hasła
            setTimeout(() => {
                document.getElementById('password').focus();
            }, 100);
        }

        // Funkcja logowania
        function login() {
            const password = document.getElementById('password').value;
            const passwordHash = btoa(password); // Kodowanie base64
            
            if (passwordHash === STUDENT_PASSWORD_HASH) {
                // Logowanie studenta
                sessionStorage.setItem('testAuthenticated', 'true');
                sessionStorage.setItem('userRole', 'student');
                showStartScreen();
            } else if (passwordHash === ADMIN_PASSWORD_HASH) {
                // Logowanie admina
                sessionStorage.setItem('testAuthenticated', 'true');
                sessionStorage.setItem('userRole', 'admin');
                showAdminPanel();
            } else {
                // Błędne hasło
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }
        }

        // Panel administracyjny
        function showAdminPanel() {
            const stats = getTestStatistics();
            const content = document.getElementById('content');
            
            content.innerHTML = `
                <div class="admin-panel">
                    <h2>Panel Administracyjny</h2>
                    <p>Witaj dr Choroś! Oto statystyki testów.</p>
                    
                    <div class="stats-overview">
                        <div class="stat-box">
                            <div class="value">${stats.totalTests}</div>
                            <div class="label">Wszystkie testy</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.averageScore}%</div>
                            <div class="label">Średni wynik</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.passRate}%</div>
                            <div class="label">Zdawalność (>60%)</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.averageTime}</div>
                            <div class="label">Średni czas</div>
                        </div>
                    </div>
                    
                    <div class="test-history">
                        <h4>Historia testów (ostatnie 50)</h4>
                        ${stats.history.slice(-50).reverse().map(entry => `
                            <div class="test-entry">
                                <div>
                                    <div class="date">${new Date(entry.date).toLocaleString('pl-PL')}</div>
                                    <div style="font-size: 0.9em; color: #666;">
                                        ${entry.categories.join(', ')} | ${entry.difficulty} | ${entry.questionCount} pytań
                                    </div>
                                </div>
                                <div class="score">${entry.score}%</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="admin-actions">
                        <button class="btn" onclick="exportStatistics()">📊 Eksportuj statystyki</button>
                        <button class="btn btn-success" onclick="showStartScreen()">✏️ Przejdź do testu</button>
                        <button class="btn btn-danger" onclick="if(confirm('Czy na pewno chcesz wyczyścić wszystkie statystyki?')) clearStatistics()">🗑️ Wyczyść dane</button>
                        <button class="btn btn-secondary" onclick="logout()">🚪 Wyloguj</button>
                    </div>
                </div>
            `;
        }

        // Funkcje statystyk
        function getTestStatistics() {
            const history = JSON.parse(localStorage.getItem('testHistory') || '[]');
            
            if (history.length === 0) {
                return {
                    totalTests: 0,
                    averageScore: 0,
                    passRate: 0,
                    averageTime: '0:00',
                    history: []
                };
            }
            
            const totalScore = history.reduce((sum, test) => sum + test.score, 0);
            const averageScore = Math.round(totalScore / history.length);
            const passedTests = history.filter(test => test.score >= 60).length;
            const passRate = Math.round((passedTests / history.length) * 100);
            
            const totalTime = history.reduce((sum, test) => sum + test.timeSpent, 0);
            const avgTimeSeconds = Math.round(totalTime / history.length);
            const avgMinutes = Math.floor(avgTimeSeconds / 60);
            const avgSeconds = avgTimeSeconds % 60;
            const averageTime = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            
            return {
                totalTests: history.length,
                averageScore,
                passRate,
                averageTime,
                history
            };
        }

        function saveTestResult(score, timeSpent, categories, difficulty, questionCount) {
            const history = JSON.parse(localStorage.getItem('testHistory') || '[]');
            
            history.push({
                date: new Date().toISOString(),
                score,
                timeSpent,
                categories,
                difficulty,
                questionCount
            });
            
            // Ogranicz historię do 1000 ostatnich wyników
            if (history.length > 1000) {
                history.shift();
            }
            
            localStorage.setItem('testHistory', JSON.stringify(history));
        }

        function exportStatistics() {
            const stats = getTestStatistics();
            const csvContent = [
                ['Data', 'Wynik (%)', 'Czas (s)', 'Kategorie', 'Poziom', 'Liczba pytań'],
                ...stats.history.map(entry => [
                    new Date(entry.date).toLocaleString('pl-PL'),
                    entry.score,
                    entry.timeSpent,
                    entry.categories.join(';'),
                    entry.difficulty,
                    entry.questionCount
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `statystyki_test_reklama_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function clearStatistics() {
            localStorage.removeItem('testHistory');
            showAdminPanel();
        }

        function logout() {
            sessionStorage.clear();
            showLoginScreen();
        }

        // Modyfikacja funkcji startTest
        const originalStartTest = startTest;
        startTest = function() {
            if (sessionStorage.getItem('userRole') === 'admin') {
                if (!confirm('Jako administrator rozpoczynasz test. Wynik zostanie zapisany w statystykach. Kontynuować?')) {
                    return;
                }
            }
            originalStartTest();
        };

        // Modyfikacja funkcji finishTest
        const originalFinishTest = finishTest;
        finishTest = function() {
            clearInterval(timerInterval);
            closeModal();
            
            // Zapisz wynik w statystykach
            const totalQuestions = currentQuestions.length;
            const correctAnswers = calculateScore();
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            const timeSpent = Math.floor((Date.now() - testStartTime) / 1000);
            
            // Zapisz lokalnie
            saveTestResult(percentage, timeSpent, selectedCategories, selectedDifficulty, totalQuestions);
            
            // Wyślij do Google Forms (działa w tle)
            sendToGoogleForms(percentage, timeSpent, selectedCategories, selectedDifficulty, totalQuestions);
            
            showResults();
        };

        // Funkcja wysyłająca wyniki do Google Forms
        function sendToGoogleForms(score, timeSpent, categories, difficulty, questionCount) {
            // ID formularza
            const FORM_ID = '1FAIpQLSd1c1GThwCtvYPPTkuX9mGzT2fNQqbjUbgFAcLMd9hDFo1FCw';
            const FORM_URL = `https://docs.google.com/forms/d/e/${FORM_ID}/formResponse`;
            
            // Przygotuj dane
            const minutes = Math.floor(timeSpent / 60);
            const seconds = timeSpent % 60;
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            const dateString = new Date().toLocaleString('pl-PL');
            
            // Mapowanie poziomów trudności na polski
            const difficultyMap = {
                'easy': 'łatwy',
                'medium': 'średni',
                'hard': 'trudny'
            };
            
            // ID pól formularza (pobrane z pre-filled link)
            const formData = new FormData();
            formData.append('entry.1954519085', dateString); // Data i czas
            formData.append('entry.620842263', score.toString()); // Wynik procentowy
            formData.append('entry.398843149', timeString); // Czas trwania
            formData.append('entry.1638000047', categories.join(', ')); // Kategorie
            formData.append('entry.1116600267', difficultyMap[difficulty] || difficulty); // Poziom trudności
            formData.append('entry.1445809399', questionCount.toString()); // Liczba pytań
            
            // Wyślij dane w tle (użytkownik tego nie zobaczy)
            fetch(FORM_URL, {
                method: 'POST',
                body: formData,
                mode: 'no-cors' // Ważne! Pozwala wysłać dane bez problemów z CORS
            }).then(() => {
                console.log('Wynik został zapisany w Google Forms');
            }).catch(error => {
                // Ignoruj błędy - nie chcemy przerywać testu
                console.log('Nie udało się wysłać wyniku do formularza');
            });
        }

        // Funkcja do losowania wariantu pytania
        function selectQuestionVariant(questionData) {
            if (questionData.variants) {
                const variant = questionData.variants[Math.floor(Math.random() * questionData.variants.length)];
                return {
                    category: questionData.category,
                    type: questionData.type || 'single',
                    ...variant
                };
            }
            return questionData;
        }

        // Ekran startowy
        function showStartScreen() {
            const categories = [...new Set(questionBank.map(q => q.category))];
            
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="start-screen">
                    <h2>Witaj w teście z Reklamy!</h2>
                    <p>Ten interaktywny test pomoże Ci sprawdzić swoją wiedzę z przedmiotu. 
                    Test zawiera różne typy pytań: jednokrotnego wyboru, wielokrotnego wyboru, 
                    prawda/fałsz oraz uzupełnianie luk.</p>
                    
                    <div class="difficulty-select">
                        <h3>Wybierz poziom trudności:</h3>
                        <div class="difficulty-options">
                            <div class="difficulty-option ${selectedDifficulty === 'easy' ? 'selected' : ''}" 
                                 onclick="selectDifficulty('easy')">
                                Łatwy (10 pytań)
                            </div>
                            <div class="difficulty-option ${selectedDifficulty === 'medium' ? 'selected' : ''}" 
                                 onclick="selectDifficulty('medium')">
                                Średni (15 pytań)
                            </div>
                            <div class="difficulty-option ${selectedDifficulty === 'hard' ? 'selected' : ''}" 
                                 onclick="selectDifficulty('hard')">
                                Trudny (20 pytań)
                            </div>
                        </div>
                    </div>
                    
                    <div class="category-select">
                        <h3>Wybierz kategorie do testu:</h3>
                        <div class="category-grid">
                            ${categories.map(cat => `
                                <div class="category-item" onclick="toggleCategory('${cat}')">
                                    <input type="checkbox" id="cat-${cat.replace(/\s/g, '-')}" value="${cat}" checked>
                                    <label for="cat-${cat.replace(/\s/g, '-')}">${cat}</label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <button class="btn" onclick="startTest()">Rozpocznij Test</button>
                </div>
            `;
            
            selectedCategories = categories;
        }

        // Wybór poziomu trudności
        function selectDifficulty(level) {
            selectedDifficulty = level;
            document.querySelectorAll('.difficulty-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // Przełączanie kategorii
        function toggleCategory(category) {
            const checkbox = document.getElementById(`cat-${category.replace(/\s/g, '-')}`);
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked && !selectedCategories.includes(category)) {
                selectedCategories.push(category);
            } else if (!checkbox.checked) {
                selectedCategories = selectedCategories.filter(c => c !== category);
            }
        }

        // Start testu
        function startTest() {
            if (selectedCategories.length === 0) {
                alert('Wybierz przynajmniej jedną kategorię!');
                return;
            }
            
            // Filtruj pytania według wybranych kategorii
            let filteredQuestions = questionBank.filter(q => selectedCategories.includes(q.category));
            
            // Przetwórz pytania z wariantami
            currentQuestions = filteredQuestions.map(q => selectQuestionVariant(q));
            
            // Losowe przetasowanie
            currentQuestions.sort(() => Math.random() - 0.5);
            
            // Ogranicz liczbę pytań według poziomu trudności
            const questionCounts = { easy: 10, medium: 15, hard: 20 };
            const maxQuestions = questionCounts[selectedDifficulty];
            
            if (currentQuestions.length > maxQuestions) {
                currentQuestions = currentQuestions.slice(0, maxQuestions);
            }
            
            currentQuestionIndex = 0;
            userAnswers = new Array(currentQuestions.length).fill(null);
            testStartTime = Date.now();
            hintsUsed = 0;
            
            showQuestion();
            startTimer();
        }

        // Timer
        function startTimer() {
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - testStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            const timerElement = document.querySelector('.timer');
            if (timerElement) {
                timerElement.innerHTML = `
                    <svg class="timer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10" stroke-width="2"/>
                        <path d="M12 6v6l4 2" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    ${minutes}:${seconds.toString().padStart(2, '0')}
                `;
            }
        }

        // Wyświetlanie pytania
        function showQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
            
            document.getElementById('progressBar').style.width = progress + '%';
            
            const content = document.getElementById('content');
            
            let questionHTML = `
                <div class="question-container">
                    <div class="question-header">
                        <div class="question-info">
                            <span class="question-number">Pytanie ${currentQuestionIndex + 1} z ${currentQuestions.length}</span>
                            <span class="question-type">${getQuestionTypeLabel(question.type)}</span>
                            <span class="timer">
                                <svg class="timer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="12" cy="12" r="10" stroke-width="2"/>
                                    <path d="M12 6v6l4 2" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                0:00
                            </span>
                        </div>
                        <span class="question-category">${question.category}</span>
                    </div>
                    
                    <h3 class="question-text">${question.question}</h3>
            `;
            
            // Dodaj wskazówkę jeśli dostępna
            if (question.hint && !userAnswers[currentQuestionIndex]) {
                questionHTML += `
                    <button class="hint-btn" onclick="showHint()" id="hintBtn">
                        💡 Pokaż wskazówkę
                    </button>
                    <div id="hintContainer"></div>
                `;
            }
            
            // Renderuj odpowiedzi według typu pytania
            questionHTML += renderAnswerSection(question);
            
            questionHTML += `
                    <div id="explanation"></div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                        <div>
                            ${currentQuestionIndex > 0 ? 
                                '<button class="btn btn-secondary" onclick="previousQuestion()">Poprzednie</button>' : 
                                '<div></div>'
                            }
                        </div>
                        <div>
                            ${currentQuestionIndex < currentQuestions.length - 1 ?
                                '<button class="btn" onclick="nextQuestion()">Następne</button>' :
                                '<button class="btn" onclick="showEndModal()">Zakończ Test</button>'
                            }
                        </div>
                    </div>
                </div>
            `;
            
            content.innerHTML = questionHTML;
            updateTimer();
            
            // Przywróć poprzednie odpowiedzi jeśli wracamy do pytania
            if (userAnswers[currentQuestionIndex] !== null) {
                restoreAnswer(question, userAnswers[currentQuestionIndex]);
            }
        }

        // Funkcja do określenia etykiety typu pytania
        function getQuestionTypeLabel(type) {
            const labels = {
                'single': 'Jednokrotny wybór',
                'multiple': 'Wielokrotny wybór',
                'true-false': 'Prawda/Fałsz',
                'fill-blank': 'Uzupełnij luki'
            };
            return labels[type] || 'Pytanie';
        }

        // Renderowanie sekcji odpowiedzi według typu
        function renderAnswerSection(question) {
            switch (question.type) {
                case 'multiple':
                    return renderMultipleChoice(question);
                case 'true-false':
                    return renderTrueFalse(question);
                case 'fill-blank':
                    return renderFillBlank(question);
                default: // single
                    return renderSingleChoice(question);
            }
        }

        // Renderowanie pytania jednokrotnego wyboru
        function renderSingleChoice(question) {
            return `
                <div class="answers">
                    ${question.answers.map((answer, index) => `
                        <div class="answer" onclick="selectAnswer(${index})">
                            <input type="radio" name="answer" id="answer-${index}" value="${index}">
                            <label for="answer-${index}">${answer}</label>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Renderowanie pytania wielokrotnego wyboru
        function renderMultipleChoice(question) {
            return `
                <div class="answers">
                    <p style="margin-bottom: 15px; color: #666;">
                        <em>Zaznacz wszystkie poprawne odpowiedzi (${question.correct.length} poprawnych)</em>
                    </p>
                    ${question.answers.map((answer, index) => `
                        <div class="answer" onclick="toggleMultipleAnswer(${index})">
                            <input type="checkbox" id="answer-${index}" value="${index}">
                            <label for="answer-${index}">${answer}</label>
                        </div>
                    `).join('')}
                    <button class="btn" style="margin-top: 20px;" onclick="submitMultipleChoice()">
                        Sprawdź odpowiedź
                    </button>
                </div>
            `;
        }

        // Renderowanie pytania prawda/fałsz
        function renderTrueFalse(question) {
            return `
                <div class="true-false-container">
                    <button class="true-false-btn" onclick="selectTrueFalse(true)">
                        ✓ Prawda
                    </button>
                    <button class="true-false-btn" onclick="selectTrueFalse(false)">
                        ✗ Fałsz
                    </button>
                </div>
            `;
        }

        // Renderowanie pytania z lukami
        function renderFillBlank(question) {
            let textWithBlanks = question.question;
            question.blanks.forEach((blank, index) => {
                textWithBlanks = textWithBlanks.replace('_____', 
                    `<input type="text" class="fill-blank-input" id="blank-${index}" 
                     placeholder="..." data-answer="${blank}">`);
            });
            
            return `
                <div class="fill-blank-container">
                    <p class="fill-blank-text">${textWithBlanks}</p>
                    <button class="btn" style="margin-top: 20px;" onclick="checkFillBlank()">
                        Sprawdź odpowiedź
                    </button>
                </div>
            `;
        }

        // Obsługa odpowiedzi dla różnych typów pytań
        function selectAnswer(index) {
            const question = currentQuestions[currentQuestionIndex];
            userAnswers[currentQuestionIndex] = index;
            
            // Zaznacz wybraną odpowiedź
            document.querySelectorAll('.answer').forEach((el, i) => {
                el.classList.toggle('selected', i === index);
            });
            
            showExplanation(index === question.correct);
        }

        function toggleMultipleAnswer(index) {
            const checkbox = document.getElementById(`answer-${index}`);
            checkbox.checked = !checkbox.checked;
            
            const answerDiv = checkbox.closest('.answer');
            answerDiv.classList.toggle('selected', checkbox.checked);
        }

        function submitMultipleChoice() {
            const question = currentQuestions[currentQuestionIndex];
            const selected = [];
            
            document.querySelectorAll('.answers input[type="checkbox"]:checked').forEach(cb => {
                selected.push(parseInt(cb.value));
            });
            
            userAnswers[currentQuestionIndex] = selected;
            
            // Sprawdź poprawność
            const isCorrect = selected.length === question.correct.length &&
                selected.every(s => question.correct.includes(s));
            
            // Oznacz odpowiedzi
            document.querySelectorAll('.answer').forEach((el, i) => {
                if (question.correct.includes(i)) {
                    el.classList.add('correct');
                } else if (selected.includes(i) && !question.correct.includes(i)) {
                    el.classList.add('incorrect');
                }
            });
            
            showExplanation(isCorrect);
        }

        function selectTrueFalse(value) {
            const question = currentQuestions[currentQuestionIndex];
            userAnswers[currentQuestionIndex] = value;
            
            // Zaznacz wybrany przycisk
            document.querySelectorAll('.true-false-btn').forEach(btn => {
                btn.classList.remove('selected', 'correct', 'incorrect');
            });
            
            const selectedBtn = event.target;
            selectedBtn.classList.add('selected');
            
            // Pokaż poprawność
            if (value === question.correct) {
                selectedBtn.classList.add('correct');
            } else {
                selectedBtn.classList.add('incorrect');
                // Oznacz poprawną odpowiedź
                document.querySelectorAll('.true-false-btn').forEach(btn => {
                    if ((btn.textContent.includes('Prawda') && question.correct === true) ||
                        (btn.textContent.includes('Fałsz') && question.correct === false)) {
                        btn.classList.add('correct');
                    }
                });
            }
            
            showExplanation(value === question.correct);
        }

        function checkFillBlank() {
            const question = currentQuestions[currentQuestionIndex];
            const userInputs = [];
            let allCorrect = true;
            
            question.blanks.forEach((correctAnswer, index) => {
                const input = document.getElementById(`blank-${index}`);
                const userAnswer = input.value.trim().toLowerCase();
                userInputs.push(userAnswer);
                
                const isCorrect = userAnswer === correctAnswer.toLowerCase();
                input.classList.remove('correct', 'incorrect');
                input.classList.add(isCorrect ? 'correct' : 'incorrect');
                
                if (!isCorrect) allCorrect = false;
            });
            
            userAnswers[currentQuestionIndex] = userInputs;
            showExplanation(allCorrect);
        }

        // Pokazywanie wskazówki
        function showHint() {
            const question = currentQuestions[currentQuestionIndex];
            hintsUsed++;
            
            document.getElementById('hintBtn').style.display = 'none';
            document.getElementById('hintContainer').innerHTML = `
                <div class="hint">
                    <strong>💡 Wskazówka:</strong> ${question.hint}
                </div>
            `;
        }

        // Pokazywanie wyjaśnienia
        function showExplanation(isCorrect) {
            const question = currentQuestions[currentQuestionIndex];
            
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.innerHTML = `
                <div class="explanation">
                    <h4>${isCorrect ? '✓ Poprawna odpowiedź!' : '✗ Niepoprawna odpowiedź'}</h4>
                    <p>${question.explanation}</p>
                </div>
            `;
        }

        // Przywracanie odpowiedzi przy nawigacji
        function restoreAnswer(question, answer) {
            switch (question.type) {
                case 'multiple':
                    answer.forEach(index => {
                        document.getElementById(`answer-${index}`).checked = true;
                        document.querySelectorAll('.answer')[index].classList.add('selected');
                    });
                    submitMultipleChoice();
                    break;
                    
                case 'true-false':
                    selectTrueFalse(answer);
                    break;
                    
                case 'fill-blank':
                    answer.forEach((text, index) => {
                        document.getElementById(`blank-${index}`).value = text;
                    });
                    checkFillBlank();
                    break;
                    
                default: // single
                    selectAnswer(answer);
            }
        }

        // Nawigacja
        function nextQuestion() {
            if (userAnswers[currentQuestionIndex] === null) {
                alert('Odpowiedz na pytanie przed przejściem dalej!');
                return;
            }
            currentQuestionIndex++;
            showQuestion();
        }

        function previousQuestion() {
            currentQuestionIndex--;
            showQuestion();
        }

        // Modal końcowy
        function showEndModal() {
            if (userAnswers[currentQuestionIndex] === null) {
                alert('Odpowiedz na pytanie przed zakończeniem testu!');
                return;
            }
            document.getElementById('endModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('endModal').style.display = 'none';
        }

        // Zakończenie testu i obliczanie wyników
        function finishTest() {
            clearInterval(timerInterval);
            closeModal();
            showResults();
        }

        // Obliczanie wyników dla różnych typów pytań
        function calculateScore() {
            let correct = 0;
            
            currentQuestions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                
                switch (question.type) {
                    case 'multiple':
                        if (Array.isArray(userAnswer) && 
                            userAnswer.length === question.correct.length &&
                            userAnswer.every(a => question.correct.includes(a))) {
                            correct++;
                        }
                        break;
                        
                    case 'true-false':
                        if (userAnswer === question.correct) {
                            correct++;
                        }
                        break;
                        
                    case 'fill-blank':
                        if (Array.isArray(userAnswer) &&
                            userAnswer.every((a, i) => 
                                a.toLowerCase() === question.blanks[i].toLowerCase())) {
                            correct++;
                        }
                        break;
                        
                    default: // single
                        if (userAnswer === question.correct) {
                            correct++;
                        }
                }
            });
            
            return correct;
        }

        // Wyświetlanie wyników
        function showResults() {
            const totalQuestions = currentQuestions.length;
            const correctAnswers = calculateScore();
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            const timeSpent = Math.floor((Date.now() - testStartTime) / 1000);
            const minutes = Math.floor(timeSpent / 60);
            const seconds = timeSpent % 60;
            
            // Określ ocenę
            let grade, gradeClass;
            if (percentage >= 90) {
                grade = 'Celujący!';
                gradeClass = 'grade-excellent';
            } else if (percentage >= 75) {
                grade = 'Bardzo dobry';
                gradeClass = 'grade-good';
            } else if (percentage >= 60) {
                grade = 'Dobry';
                gradeClass = 'grade-pass';
            } else {
                grade = 'Do poprawy';
                gradeClass = 'grade-fail';
            }
            
            // Statystyki według typu pytań
            const typeStats = {};
            currentQuestions.forEach((q, i) => {
                if (!typeStats[q.type]) {
                    typeStats[q.type] = { total: 0, correct: 0 };
                }
                typeStats[q.type].total++;
                
                const userAnswer = userAnswers[i];
                let isCorrect = false;
                
                switch (q.type) {
                    case 'multiple':
                        isCorrect = Array.isArray(userAnswer) && 
                            userAnswer.length === q.correct.length &&
                            userAnswer.every(a => q.correct.includes(a));
                        break;
                    case 'true-false':
                        isCorrect = userAnswer === q.correct;
                        break;
                    case 'fill-blank':
                        isCorrect = Array.isArray(userAnswer) &&
                            userAnswer.every((a, idx) => 
                                a.toLowerCase() === q.blanks[idx].toLowerCase());
                        break;
                    default:
                        isCorrect = userAnswer === q.correct;
                }
                
                if (isCorrect) typeStats[q.type].correct++;
            });
            
            // Wyniki według kategorii
            const categoryResults = {};
            selectedCategories.forEach(cat => {
                const catQuestions = currentQuestions.filter(q => q.category === cat);
                const catCorrect = catQuestions.reduce((sum, q) => {
                    const qIndex = currentQuestions.indexOf(q);
                    const userAnswer = userAnswers[qIndex];
                    let isCorrect = false;
                    
                    switch (q.type) {
                        case 'multiple':
                            isCorrect = Array.isArray(userAnswer) && 
                                userAnswer.length === q.correct.length &&
                                userAnswer.every(a => q.correct.includes(a));
                            break;
                        case 'true-false':
                            isCorrect = userAnswer === q.correct;
                            break;
                        case 'fill-blank':
                            isCorrect = Array.isArray(userAnswer) &&
                                userAnswer.every((a, idx) => 
                                    a.toLowerCase() === q.blanks[idx].toLowerCase());
                            break;
                        default:
                            isCorrect = userAnswer === q.correct;
                    }
                    
                    return sum + (isCorrect ? 1 : 0);
                }, 0);
                
                if (catQuestions.length > 0) {
                    categoryResults[cat] = {
                        correct: catCorrect,
                        total: catQuestions.length,
                        percentage: Math.round((catCorrect / catQuestions.length) * 100)
                    };
                }
            });
            
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="results">
                    <h2>Twoje wyniki</h2>
                    
                    <div class="score-circle">
                        <svg viewBox="0 0 200 200">
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#667eea" />
                                    <stop offset="100%" style="stop-color:#764ba2" />
                                </linearGradient>
                            </defs>
                            <circle class="background" cx="100" cy="100" r="90"/>
                            <circle class="progress" cx="100" cy="100" r="90"
                                stroke-dasharray="${percentage * 5.65} 565"
                                stroke-dashoffset="0"/>
                        </svg>
                        <div class="score-text">${percentage}%</div>
                    </div>
                    
                    <div class="${gradeClass} grade-badge">${grade}</div>
                    
                    <h3>Odpowiedziałeś poprawnie na ${correctAnswers} z ${totalQuestions} pytań</h3>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="value">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                            <div class="label">Czas trwania</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${selectedDifficulty === 'easy' ? 'Łatwy' : selectedDifficulty === 'medium' ? 'Średni' : 'Trudny'}</div>
                            <div class="label">Poziom trudności</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${hintsUsed}</div>
                            <div class="label">Użyte wskazówki</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${Math.round(timeSpent/totalQuestions)}s</div>
                            <div class="label">Średni czas/pytanie</div>
                        </div>
                    </div>
                    
                    <div class="category-results">
                        <h4>Wyniki według typu pytań:</h4>
                        ${Object.entries(typeStats).map(([type, stats]) => `
                            <div class="category-result">
                                <span class="name">${getQuestionTypeLabel(type)}</span>
                                <span class="score">${stats.correct}/${stats.total} (${Math.round(stats.correct/stats.total * 100)}%)</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="category-results">
                        <h4>Wyniki według kategorii:</h4>
                        ${Object.entries(categoryResults).map(([cat, result]) => `
                            <div class="category-result">
                                <span class="name">${cat}</span>
                                <span class="score">${result.correct}/${result.total} (${result.percentage}%)</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button class="btn" onclick="reviewAnswers()">Przejrzyj odpowiedzi</button>
                    <button class="btn btn-secondary" onclick="showStartScreen()">Nowy test</button>
                </div>
            `;
        }

        // Przegląd odpowiedzi
        function reviewAnswers() {
            let reviewHTML = '<div class="review"><h2>Przegląd odpowiedzi</h2>';
            
            currentQuestions.forEach((q, i) => {
                const userAnswer = userAnswers[i];
                let isCorrect = false;
                let userAnswerText = '';
                let correctAnswerText = '';
                
                switch (q.type) {
                    case 'multiple':
                        isCorrect = Array.isArray(userAnswer) && 
                            userAnswer.length === q.correct.length &&
                            userAnswer.every(a => q.correct.includes(a));
                        userAnswerText = Array.isArray(userAnswer) ? 
                            userAnswer.map(idx => q.answers[idx]).join(', ') : 'Brak odpowiedzi';
                        correctAnswerText = q.correct.map(idx => q.answers[idx]).join(', ');
                        break;
                        
                    case 'true-false':
                        isCorrect = userAnswer === q.correct;
                        userAnswerText = userAnswer === true ? 'Prawda' : userAnswer === false ? 'Fałsz' : 'Brak odpowiedzi';
                        correctAnswerText = q.correct ? 'Prawda' : 'Fałsz';
                        break;
                        
                    case 'fill-blank':
                        isCorrect = Array.isArray(userAnswer) &&
                            userAnswer.every((a, idx) => 
                                a.toLowerCase() === q.blanks[idx].toLowerCase());
                        userAnswerText = Array.isArray(userAnswer) ? userAnswer.join(', ') : 'Brak odpowiedzi';
                        correctAnswerText = q.blanks.join(', ');
                        break;
                        
                    default: // single
                        isCorrect = userAnswer === q.correct;
                        userAnswerText = userAnswer !== null ? q.answers[userAnswer] : 'Brak odpowiedzi';
                        correctAnswerText = q.answers[q.correct];
                }
                
                reviewHTML += `
                    <div class="question-review" style="margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h4 style="color: ${isCorrect ? '#28a745' : '#dc3545'}">
                            Pytanie ${i + 1} (${getQuestionTypeLabel(q.type)}): ${isCorrect ? '✓ Poprawnie' : '✗ Błędnie'}
                        </h4>
                        <p><strong>${q.question}</strong></p>
                        <p><strong>Twoja odpowiedź:</strong> ${userAnswerText}</p>
                        ${!isCorrect ? `<p><strong>Poprawna odpowiedź:</strong> ${correctAnswerText}</p>` : ''}
                        <p style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px;">
                            <em>${q.explanation}</em>
                        </p>
                    </div>
                `;
            });
            
            reviewHTML += `
                <button class="btn" onclick="showResults()">Powrót do wyników</button>
                <button class="btn btn-secondary" onclick="showStartScreen()">Nowy test</button>
            </div>`;
            
            document.getElementById('content').innerHTML = reviewHTML;
        }
    </script>
</body>
</html> 